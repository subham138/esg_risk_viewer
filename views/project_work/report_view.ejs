<%- include('../templates/header.ejs', {header: "Dashboard", header_url: "/dashboard", sub_header: `${header} (${flag_name})`, sub_header_url: header_url, sub_sub_header: `"${projName}"`, show_br: true}) %>
<script src="/js/chart/google/google-chart-loader.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>




<!-- morris-chart -->
    <script src="/js/chart/morris-chart/raphael.js"></script>
    <script src="/js/chart/morris-chart/morris.js"> </script>
    <script src="/js/chart/morris-chart/prettify.min.js"></script>
    <script src="/js/chart/morris-chart/morris.min.js"></script>
    <script src="/js/chart/morris-chart/morris-script.js"></script>
<!-- END -->
<!-- Reach TextEditor -->
    <link rel="stylesheet" href="/editor/richtexteditor/rte_theme_default.css" />
    <script type="text/javascript" src="/editor/richtexteditor/rte.js"></script>
    <script type="text/javascript" src='/editor/richtexteditor/plugins/all_plugins.js'></script>
    <% if(flag == "F" || flag == "IF" || flag == "EF" || flag == "EVF"){ %>
        <script>document.write("<script src='/editor/richtexteditor/lang/rte-lang-fr.js'></scr" + "ipt>");</script>
    <% } %>
<!-- END -->

<style>
    .topic_text {
      text-align: center;
      vertical-align: middle;
    }
    /* .nav {
        flex-direction: row;
        justify-content: space-around;
        border-bottom: 1px solid #d0cccc;
        padding-bottom: 7px;
    }
    li.nav-item {
        background: #f8f6f6;
    } */
    /* .sticky {
    position: fixed !important;
    top: 82px;
    width: 100%;
    z-index: 999;
    background: #f5f7fb;
    padding-top: 23px;
    } */
  </style>
<script>
    google.charts.load('current', {packages: ['corechart', 'bar', 'line']});
    var fun = {}, i = 1, wordList = {}, totCount ={};
    var editorList= {};
</script>
<div class="container-fluid">
    <div class="page-header">
        <div class="row">
            <div class="col-sm-12" id="myHeader">
                <ul class="nav nav-tabs border-tab nav-primary" id="info-tab" role="tablist">
                    <li class="nav-item"><a class="nav-link active" id="expo-tab" data-bs-toggle="pill" href="#expo" role="tab" aria-controls="expo" aria-selected="true"><%= lang.report_edit.tab1.title %></a></li>
                    <li class="nav-item"><a class="nav-link" id="dis-top-tab" data-bs-toggle="pill" href="#dis-top" role="tab" aria-controls="dis-top" aria-selected="false"><%= lang.report_edit.tab2.title %></a></li>
                    <li class="nav-item"><a class="nav-link" id="msg-dis-top-tab" data-bs-toggle="pill" href="#msg-dis-top" role="tab" aria-controls="msg-dis-top" aria-selected="false"><%= lang.report_edit.tab3.title %></a></li>
                    <li class="nav-item"><a class="nav-link" id="ghg-emi-tab" data-bs-toggle="pill" href="#ghg-emi" role="tab" aria-controls="ghg-emi" aria-selected="false"><%= lang.report_edit.tab4.title %></a></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-12">
            <div class="card card_body_Cus">
                <!-- <div class="card-header pb-0">
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <p class="pro-card-head">
                                <span class="fw-normal"><%= lang.manage.head %> <b><%= projName %></b></span> 
                                <br>
                                <span class="pro-card-cont fw-normal"><b><%= lang.framework[flag] %></b></span>
                            </p>
                        </div>
                    </div>
                </div> -->
                <div class="card-body">
                    <div class="row">
                        <!-- <div class="col-sm-12 col-xl-6 xl-100"> -->
                        <div class="col-sm-12 col-xl-12 xl-100">
                            <div class="tab-content" id="pills-icontabContent">
                                <!-- <div class="tab-pane fade show active" id="expo" role="tabpanel" aria-labelledby="expo-tab">
                                    <div class="row m-t-10">
                                        <div class="col-md-12">
                                            <div class="default-according style-1" id="expoAccordionoc">
                                                <div class="card">
                                                    <div class="card-header bg-primary caruBackCol">
                                                        <h5 class="mb-0">
                                                            <button class="btn btn-link text-white" data-bs-toggle="collapse" data-bs-target="#exposi" aria-expanded="true" aria-controls="collapse11">Exposure</button>
                                                        </h5>
                                                    </div>
                                                    <div class="collapse show" id="exposi" aria-labelledby="exposi" data-bs-parent="#expoAccordionoc"> -->
                                                        <div class="tab-pane fade show active" id="expo" role="tabpanel">
                                                            <div class="row m-3">
                                                                <div class="col-md-12">
                                                                    <%# include('dynamic_data_exposer', {allDynamicData, data_set, lang}) %>
                                                                    <%- include('risk_ino_dtls', {risk_info_dt, lang}) %>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    <!-- </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div> -->
                                <!-- <div class="tab-pane fade" id="dis-top" role="tabpanel" aria-labelledby="dis-top-tab">
                                    <div class="row" id="topic_metrics_data">
                                        <div class="col-md-12">
                                            <div class="default-according style-1" id="accordionoc">
                                                <div class="card">
                                                    <div class="card-header bg-primary caruBackCol">
                                                        <h5 class="mb-0">
                                                            <button class="btn btn-link text-white" data-bs-toggle="collapse" data-bs-target="#disTop" aria-expanded="true" aria-controls="collapse11">Disclosure topics</button>
                                                        </h5>
                                                    </div>
                                                    <div class="collapse m-3 show" id="disTop" aria-labelledby="disTop" data-bs-parent="#accordionoc"> -->
                                                        <div class="tab-pane fade" id="dis-top" role="tabpanel">
                                                            <div class="row">
                                                                <!-- <div class="col-md-12 m-b-10">
                                                                    <p class="dyn-col-head">Sustainability Disclosure Topics & Metrics</p>
                                                                </div> -->
                                                                <div class="col-md-12">
                                                                    <%- include('sus_dis_top_met', {susDistList, flag, act_top_catg_list, get_checked_top_list, lang}) %>
                                                                </div>
                                                                <!-- <div class="col-md-12 m-b-10">
                                                                    <p class="dyn-col-head">Activity Metrics</p>
                                                                </div> -->
                                                                <div class="col-md-12 my-3">
                                                                    <%# include('act_met', {metric}) %>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    <!-- </div>
                                                </div>                                                
                                            </div>
                                        </div>
                                    </div>
                                </div> -->
                                <!-- <div class="tab-pane fade" id="msg-dis-top" role="tabpanel" aria-labelledby="msg-dis-top-tab">
                                    <div class="col-md-12">
                                        <div class="default-according style-1" id="editorAcord">
                                            <div class="card">
                                                <div class="card-header bg-primary caruBackCol">
                                                    <h5 class="mb-0">
                                                        <button class="btn btn-link text-white" data-bs-toggle="collapse" data-bs-target="#ifrs" aria-expanded="true" aria-controls="collapse11">Manage Disclosure Topics (<%= flag == "I" ? "IFRS" : (flag == "E" ? "ESRS" : (flag == "G" ? "GRI" : "GRI-French"))%>)</button>
                                                    </h5>
                                                </div>
                                                <div class="collapse" id="ifrs" aria-labelledby="ifrs" data-bs-parent="#editorAcord"> -->
                                                    <div class="tab-pane fade" id="msg-dis-top" role="tabpanel">
                                                        <%# if(flag == 'I'){ %>
                                                            <%# include('man_dis_top', {susDistList, editorData, ai_tag_tool_flag, user_type}) %>
                                                        <%# }else{ %>
                                                            <%- include('man_dis_top_other', {susDistList, editorData, ai_tag_tool_flag, user_type, lang}) %>
                                                        <%# } %>
                                                    </div>
                                                <!-- </div>
                                            </div>
                                        </div>
                                    </div>
                                </div> -->
                                <!-- <div class="tab-pane fade" id="ghg-emi" role="tabpanel" aria-labelledby="ghg-emi-tab">
                                    <div class="col-md-12">
                                        <div class="default-according style-1" id="ghg">
                                            <div class="card">
                                                <div class="card-header bg-primary caruBackCol">
                                                    <h5 class="mb-0">
                                                        <button class="btn btn-link text-white" data-bs-toggle="collapse" data-bs-target="#ghg_emi" aria-expanded="true" aria-controls="collapse11">GHG Emissions</button>
                                                    </h5>
                                                </div>
                                                <div class="collapse show" id="ghg_emi" aria-labelledby="ghg_emi" data-bs-parent="#ghg"> -->
                                                    <div class="tab-pane fade" id="ghg-emi" role="tabpanel">
                                                        <div class="row m-3">
                                                            <%# if(cal_lang_flag == 'B'){ %>
                                                                <div class="col-md-12 m-b-10">
                                                                    <div class="chooleLang">
                                                                        <% if(cal_lang_flag == 'E' || cal_lang_flag == 'B'){ %>
                                                                        <div class="langContent <%= cal_lang_flag == 'E' || cal_lang_flag == 'B' ? 'active' : '' %>">UK (SECR) Conversion Factors</div>
                                                                        <% } %>
                                                                        <% if(cal_lang_flag == 'F' || cal_lang_flag == 'B'){ %>
                                                                        <div class="langContent <%= cal_lang_flag == 'F' ? 'active' : '' %>">ADEME - Facteurs d'Émissions de la Base Carbone</div>
                                                                        <% } %>
                                                                    </div>
                                                                </div>
                                                            <%# } %>
                                                            <div class="col-md-12">
                                                                <div class="default-according style-2" id="inghg">
                                                                    <div class="card custom-span-card m-b-10">
                                                                        <div class="card-header caruBackCol1 text-center">
                                                                            <h5 class="mb-0">
                                                                                <button class="btn btn-link" data-bs-toggle="collapse" data-bs-target="#scope_1" aria-expanded="true" aria-controls="collapse11"><%= lang.report_edit.tab4.scope1 %></button>
                                                                            </h5>
                                                                        </div>
                                                                        <div class="collapse show ghg-emi-tab-row" id="scope_1" aria-labelledby="scope_1" data-bs-parent="#accordionoc">
                                                                            <div class="row">
                                                                                <div class="col-md-12 text-center p-3 row">
                                                                                    <div class="col-md-12 row mt-1">
                                                                                        <div class="col-md-6"></div>
                                                                                        <% if(user_type != 'V'){ %>
                                                                                            <div class="col-md-6">
                                                                                                <button class="btn btn-pill btn-sm btn-custom float-end text-center" data-bs-original-title title="Add New Calculator" onclick="AddCal('s1')"><i class="icofont icofont-ui-add"></i><span>&nbsp;&nbsp;<%= lang.report_edit.tab4.add_btn %></span></button>
                                                                                            </div>
                                                                                        <% } %>
                                                                                    </div>
                                                                                    <div class="col-md-12 m-t-10 p-l-20 p-r-20" id="calDetails_s1">
                                                                                        <% if('s1' in ghg_emi_data){
                                                                                            var sc_len = ghg_emi_data['s1'].length / 12;
                                                                                            for(let sc = 1; sc <= sc_len; sc++){
                                                                                                var newGhgDt = ghg_emi_data['s1'].filter(dt => dt.sl_no == sc && dt.scope == 's1')
                                                                                                if(newGhgDt.length > 0){
                                                                                                    var tot_co_val_label = 0;
                                                                                                    newGhgDt.forEach(dt => tot_co_val_label += dt.co_val)
                                                                                                    var fullMonths = {'Jan': 'January', 'Feb': 'February', 'Mar': 'March', 'Apr': 'April', 'May': 'May', 'Jun': 'June', 'Jul': 'July', 'Aug': 'August', 'Sep': 'September', 'Oct': 'October', 'Nov': 'November', 'Dec': 'December'};
                                                                                                    %>
                                                                                                    <div class="card custom-span-card">
                                                                                                        <div class="card-header caruBackCol1">
                                                                                                            <h5 class="mb-0">
                                                                                                                <button class="btn btn-link" data-bs-toggle="collapse" data-bs-target="#s1_cal_<%= sc %>" aria-expanded="true" aria-controls="collapse11"><span class="infoCalLeb"><%= newGhgDt[0].type_name %> - <%= newGhgDt[0].act_name %> - <%= newGhgDt[0].emi_name %> -</span><span class="infoCalVal"> <%= tot_co_val_label %> kg CO2e </span><span class="infoCalLeb">since <%= fullMonths[newGhgDt[0].repo_month] %></span></button>
                                                                                                            </h5>
                                                                                                        </div>
                                                                                                        <div class="collapse" id="s1_cal_<%= sc %>" aria-labelledby="s1_cal_<%= sc %>" data-bs-parent="#accordionoc">
                                                                                                            <div class="row p-2">
                                                                                                                <div class="col-md-6 m-t-10">
                                                                                                                    <label class="form-label float-start" for="type_id_s1_<%= sc %>"><%= lang.report_edit.tab4.emi_sour %></label>
                                                                                                                    <select class="form-select emission_source" id="type_id_s1_<%= sc %>" name="type_id" required="" onchange="changeTypeId('s1','<%= sc %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.emi_sour_sel %></option>
                                                                                                                        <% if(type_list.length > 0){
                                                                                                                            type_list.forEach(dt => { 
                                                                                                                                if(dt.scope == 1){
                                                                                                                                    var selected = '';
                                                                                                                                    if(newGhgDt.length > 0)
                                                                                                                                        if(newGhgDt[0].sec_id == dt.id)
                                                                                                                                            selected = 'selected'; %>
                                                                                                                                <option value="<%= dt.id %>" dt-set="<%= dt.type %>" <%= selected %>><%= dt.type_name %></option>
                                                                                                                            <% }})
                                                                                                                        } %>
                                                                                                                    </select>
                                                                                                                </div>
                                                                                                                <script>
                                                                                                                    $(document).ready(async function(){
                                                                                                                        await changeTypeId('s1','<%= sc %>', '<%= newGhgDt[0].act_id %>')
                                                                                                                        await changeActId('s1','<%= sc %>', '<%= newGhgDt[0].emi_type_id %>')
                                                                                                                    })
                                                                                                                </script>
                                                                                                                <div class="col-md-6 m-t-10">
                                                                                                                    <label class="form-label float-start" for="act_id_s1_<%= sc %>"><%= lang.report_edit.tab4.act %></label>
                                                                                                                    <select class="form-select" id="act_id_s1_<%= sc %>" name="act_id" required="" onchange="changeActId('s1','<%= sc %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.act_sel %></option>
                                                                                                                        <% if(act_list.length > 0){
                                                                                                                            act_list.forEach(dt => { 
                                                                                                                                var selected = ''; %>
                                                                                                                                <option value="<%= dt.id %>"><%= dt.act_name %></option>
                                                                                                                            <% })
                                                                                                                        } %>
                                                                                                                    </select>
                                                                                                                </div>
                                                                                                                <div class="col-md-6 m-t-10">
                                                                                                                    <label class="form-label float-start" for="emi_type_id_s1_<%= sc %>"><%= lang.report_edit.tab4.emi_type %></label>
                                                                                                                    <select class="form-select" id="emi_type_id_s1_<%= sc %>" name="emi_type_id" required="" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.emi_type_sel %></option>
                                                                                                                        <% if(emi_type.length > 0){
                                                                                                                            emi_type.forEach(dt => { 
                                                                                                                                var selected = ''; %>
                                                                                                                                <option value="<%= dt.id %>"><%= dt.emi_name %></option>
                                                                                                                            <% })
                                                                                                                        } %>
                                                                                                                    </select>
                                                                                                                </div>
                                                                                                                <div class="col-md-6 m-t-10">
                                                                                                                    <label class="form-label float-start" for="repo_period_s1_<%= sc %>"><%= lang.report_edit.tab4.repo_per %></label>
                                                                                                                    <select class="form-select" id="repo_period_s1_<%= sc %>" name="repo_period" required="" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.repo_per_sel %></option>
                                                                                                                        <% if(year_list.length > 0){
                                                                                                                            year_list.forEach(dt => { 
                                                                                                                                var selected = '';
                                                                                                                                if(newGhgDt.length > 0)
                                                                                                                                    if(newGhgDt[0].repo_period == dt)
                                                                                                                                        selected = 'selected'; %>
                                                                                                                                <option value="<%= dt %>" <%= selected %>><%= dt %></option>
                                                                                                                            <% })
                                                                                                                        } %>
                                                                                                                    </select>
                                                                                                                </div>
                                                                                                                <div class="col-md-6 m-t-10">
                                                                                                                    <label class="form-label float-start" for="strt_month_s1_<%= sc %>"><%= lang.report_edit.tab4.st_month %></label>
                                                                                                                    <select class="form-select" id="strt_month_s1_<%= sc %>" name="strt_month" required="" onchange="calSelectMonth('s1','<%= sc %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.st_month_sel %></option>
                                                                                                                        <% var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                                                                                                                        if(months.length > 0){
                                                                                                                            months.forEach(dt => { 
                                                                                                                                var selected = '';
                                                                                                                                if(newGhgDt.length > 0)
                                                                                                                                    if(newGhgDt[0].repo_month == dt)
                                                                                                                                        selected = 'selected'; %>
                                                                                                                                <option value="<%= dt %>" <%= selected %>><%= dt %></option>
                                                                                                                            <% })
                                                                                                                        } %>
                                                                                                                    </select>
                                                                                                                </div>
                                                                                                                <div class="col-md-12 m-t-10 table-responsive">
                                                                                                                    <table class="table table-bordered" id="cal_val_entry_table_s1_<%= sc %>">
                                                                                                                        <thead>
                                                                                                                            <tr>
                                                                                                                                <th><%= lang.report_edit.tab4.table.head1 %></th>
                                                                                                                                <th><%= lang.report_edit.tab4.table.head2 %></th>
                                                                                                                                <th><%= lang.report_edit.tab4.table.head3 %></th>
                                                                                                                                <th><%= lang.report_edit.tab4.table.head4 %></th>
                                                                                                                                <th><%= lang.report_edit.tab4.table.head5 %></th>
                                                                                                                            </tr>
                                                                                                                        </thead>
                                                                                                                        <tbody>
                                                                                                                            <% if(newGhgDt.length > 0){
                                                                                                                                var nextCalField = 1;
                                                                                                                                var tot_cal_val = 0,
                                                                                                                                    tot_co_val = 0;
                                                                                                                                newGhgDt.forEach(gdt => {
                                                                                                                                    gdt.cal_val > 0 ? tot_cal_val += gdt.cal_val : ''
                                                                                                                                    gdt.co_val > 0 ? tot_co_val += gdt.co_val : ''
                                                                                                                                    %>
                                                                                                                                    <tr>
                                                                                                                                        <td><%= gdt.repo_month %></td>
                                                                                                                                        <td>
                                                                                                                                            <select class="form-select" id="emi_type_unit_id_s1_<%= nextCalField %>_<%= sc %>" name="emi_type_unit_id" cal-unit-id="<%= gdt.emi_type_unit_id %>" required="" onchange="setCalVal('s1', '<%= sc %>', '<%= nextCalField %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                                                <option selected="" value="">Please select unit of measurement</option>
                                                                                                                                            </select>
                                                                                                                                        </td>
                                                                                                                                        <td><input class="form-control" id="cal_val_s1_<%= nextCalField %>_<%= sc %>" name="cal_val" type="text" value="<%= gdt.cal_val %>" required="" onchange="setCoVal('s1', '<%= sc %>', '<%= nextCalField %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>></td>
                                                                                                                                        <td><input class="form-control" id="emi_fact_val_s1_<%= nextCalField %>_<%= sc %>" name="emi_fact_val" type="text" value="<%= gdt.emi_fact_val %>" required="" readonly></td>
                                                                                                                                        <td><input class="form-control" id="co_val_s1_<%= nextCalField %>_<%= sc %>" name="co_val" type="text" value="<%= gdt.co_val %>" required="" readonly onchange="setCoVal('s1', '<%= sc %>', '<%= nextCalField %>')"></td>
                                                                                                                                    </tr>
                                                                                                                                    <script>
                                                                                                                                        $(document).ready(async function(){
                                                                                                                                            await calUnitSet('s1', '<%= sc %>', true, '<%= nextCalField %>', {type_id: '<%= newGhgDt[0].sec_id %>', act_id: '<%= newGhgDt[0].act_id%>', emi_type_id: '<%= newGhgDt[0].emi_type_id%>', year: '<%= newGhgDt[0].repo_month %>'})
                                                                                                                                        })
                                                                                                                                    </script>
                                                                                                                                <%  nextCalField++; }) %> 
                                                                                                                                    <!-- <tr>
                                                                                                                                        <td colspan="2">Total</td>
                                                                                                                                        <td><span id="tot_cal_val_s1_<%# sc %>"><%# tot_cal_val %></span></td>
                                                                                                                                        <td></td>
                                                                                                                                        <td><span id="tot_co_val_s1_<%# sc %>"><%# tot_co_val %></span></td>
                                                                                                                                    </tr> -->
                                                                                                                            <% } %>
                                                                                                                        </tbody>
                                                                                                                    </table>
                                                                                                                    <div class="container cal-tot-div">
                                                                                                                        <p class="tot-cal-val"><%= tot_co_val %> Kg of CO2e</p>
                                                                                                                    </div>
                                                                                                                </div>
                                                                                                                <% if(user_type != 'V'){ %>
                                                                                                                    <div class="col-md-10 m-t-10">
                                                                                                                        <button class="btn btn-pill btn-custom  float-end" data-bs-original-title title="Save" onclick="saveCalValue('s1','<%= sc %>')"><i class="icofont icofont-save"> <%= lang.report_edit.tab4.save_btn %></i></button>
                                                                                                                    </div>
                                                                                                                    <div class="col-md-2 m-t-10">
                                                                                                                        <button class="btn btn-pill btn-custom float-right" data-bs-original-title title="delete" onclick=""><i class="icofont icofont-ui-delete"><%= lang.report_edit.tab4.del_btn %></i></button>
                                                                                                                    </div>
                                                                                                                <% } %>
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <% } %>
                                                                                                <% }
                                                                                        }else{ %>
                                                                                            <div class="row">
                                                                                                <div class="col-md-6 m-t-10">
                                                                                                    <label class="form-label float-start" for="type_id_s1_1"><%= lang.report_edit.tab4.emi_sour %></label>
                                                                                                    <select class="form-select emission_source" id="type_id_s1_1" name="type_id" required="" onchange="changeTypeId('s1',1)" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.emi_sour_sel %></option>
                                                                                                        <% if(type_list.length > 0){
                                                                                                            type_list.forEach(dt => {
                                                                                                                if(dt.scope == 1){ 
                                                                                                                    var selected = ''; %>
                                                                                                                    <option value="<%= dt.id %>" dt-set="<%= dt.type %>"><%= dt.type_name %></option>
                                                                                                            <% }})
                                                                                                        } %>
                                                                                                    </select>
                                                                                                </div>
                                                                                                <div class="col-md-6 m-t-10">
                                                                                                    <label class="form-label float-start" for="act_id_s1_1"><%= lang.report_edit.tab4.act %></label>
                                                                                                    <select class="form-select" id="act_id_s1_1" name="act_id" required="" onchange="changeActId('s1',1)" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.act_sel %></option>
                                                                                                        <% if(act_list.length > 0){
                                                                                                            act_list.forEach(dt => { 
                                                                                                                var selected = ''; %>
                                                                                                                <option value="<%= dt.id %>"><%= dt.act_name %></option>
                                                                                                            <% })
                                                                                                        } %>
                                                                                                    </select>
                                                                                                </div>
                                                                                                <div class="col-md-6 m-t-10">
                                                                                                    <label class="form-label float-start" for="emi_type_id_s1_1"><%= lang.report_edit.tab4.emi_type %></label>
                                                                                                    <select class="form-select" id="emi_type_id_s1_1" name="emi_type_id" required="" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.emi_type_sel %></option>
                                                                                                        <% if(emi_type.length > 0){
                                                                                                            emi_type.forEach(dt => { 
                                                                                                                var selected = ''; %>
                                                                                                                <option value="<%= dt.id %>"><%= dt.emi_name %></option>
                                                                                                            <% })
                                                                                                        } %>
                                                                                                    </select>
                                                                                                </div>
                                                                                                <div class="col-md-6 m-t-10">
                                                                                                    <label class="form-label float-start" for="repo_period_s1_1"><%= lang.report_edit.tab4.repo_per %></label>
                                                                                                    <select class="form-select" id="repo_period_s1_1" name="repo_period" required="" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.repo_per_sel %></option>
                                                                                                        <% if(year_list.length > 0){
                                                                                                            year_list.forEach(dt => { 
                                                                                                                var selected = ''; %>
                                                                                                                <option value="<%= dt %>"><%= dt %></option>
                                                                                                            <% })
                                                                                                        } %>
                                                                                                    </select>
                                                                                                </div>
                                                                                                <div class="col-md-6 m-t-10">
                                                                                                    <label class="form-label float-start" for="strt_month_s1_1"><%= lang.report_edit.tab4.st_month %></label>
                                                                                                    <select class="form-select" id="strt_month_s1_1" name="strt_month" required="" onchange="calSelectMonth('s1',1)" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.st_month_sel %></option>
                                                                                                        <% var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                                                                                                        if(months.length > 0){
                                                                                                            months.forEach(dt => { 
                                                                                                                var selected = ''; %>
                                                                                                                <option value="<%= dt %>"><%= dt %></option>
                                                                                                            <% })
                                                                                                        } %>
                                                                                                    </select>
                                                                                                </div>
                                                                                                <div class="col-md-12 m-t-10 table-responsive">
                                                                                                    <table class="table table-bordered" id="cal_val_entry_table_s1_1">
                                                                                                        <thead>
                                                                                                            <tr>
                                                                                                                <th><%= lang.report_edit.tab4.table.head1 %></th>
                                                                                                                <th><%= lang.report_edit.tab4.table.head2 %></th>
                                                                                                                <th><%= lang.report_edit.tab4.table.head3 %></th>
                                                                                                                <th><%= lang.report_edit.tab4.table.head4 %></th>
                                                                                                                <th><%= lang.report_edit.tab4.table.head5 %></th>
                                                                                                            </tr>
                                                                                                        </thead>
                                                                                                        <tbody></tbody>
                                                                                                    </table>
                                                                                                </div>
                                                                                                <% if(user_type != 'V'){ %>
                                                                                                    <div class="col-md-8"></div>
                                                                                                    <div class="col-md-4 m-t-10">
                                                                                                        <button class="btn btn-pill btn-custom float-end text-center" data-bs-original-title title="Save" onclick="saveCalValue('s1',1)"><i class="icofont icofont-save"> <%= lang.report_edit.tab4.save_btn %></i></button>
                                                                                                    </div>
                                                                                                <% } %>
                                                                                            </div>
                                                                                        <% } %>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-12">
                                                                        <div class="default-according style-2" id="inghg">
                                                                            <div class="card custom-span-card m-b-10">
                                                                                <div class="card-header caruBackCol1 text-center">
                                                                                    <h5 class="mb-0">
                                                                                        <button class="btn btn-link" data-bs-toggle="collapse" data-bs-target="#scope_2" aria-expanded="true" aria-controls="collapse11"><%= lang.report_edit.tab4.scope2 %></button>
                                                                                    </h5>
                                                                                </div>
                                                                                <div class="collapse" id="scope_2" aria-labelledby="scope_2" data-bs-parent="#accordionoc">
                                                                                    <div class="row">
                                                                                        <div class="col-md-12 text-center p-3 row">
                                                                                            <div class="col-md-12 row mt-1">
                                                                                                <div class="col-md-6"></div>
                                                                                                <% if(user_type != 'V'){ %>
                                                                                                    <div class="col-md-6">
                                                                                                        <button class="btn btn-pill btn-sm btn-custom float-end text-center" data-bs-original-title title="Add New Calculator" onclick="AddCal('s2')"><i class="icofont icofont-ui-add"></i><span>&nbsp;&nbsp;<%= lang.report_edit.tab4.add_btn %></span></button>
                                                                                                    </div>
                                                                                                <% } %>
                                                                                            </div>
                                                                                            <div class="col-md-12 m-t-10 p-l-20 p-r-20" id="calDetails_s2">
                                                                                                <% if('s2' in ghg_emi_data){
                                                                                                    var sc_len = ghg_emi_data['s2'].length / 12;
                                                                                                    for(let sc = 1; sc <= sc_len; sc++){
                                                                                                        var newGhgDt = ghg_emi_data['s2'].filter(dt => dt.sl_no == sc && dt.scope == 's2')
                                                                                                        if(newGhgDt.length > 0){ 
                                                                                                            var tot_co_val_label = 0;
                                                                                                            newGhgDt.forEach(dt => tot_co_val_label += dt.co_val)
                                                                                                            var fullMonths = {'Jan': 'January', 'Feb': 'February', 'Mar': 'March', 'Apr': 'April', 'May': 'May', 'Jun': 'June', 'Jul': 'July', 'Aug': 'August', 'Sep': 'September', 'Oct': 'October', 'Nov': 'November', 'Dec': 'December'};
                                                                                                            %>
                                                                                                            <div class="card custom-span-card">
                                                                                                                <div class="card-header caruBackCol1">
                                                                                                                    <h5 class="mb-0">
                                                                                                                        <button class="btn btn-link" data-bs-toggle="collapse" data-bs-target="#s2_cal_<%= sc %>" aria-expanded="true" aria-controls="collapse11"><span class="infoCalLeb"><%= newGhgDt[0].type_name %> - <%= newGhgDt[0].act_name %> - <%= newGhgDt[0].emi_name %> -</span><span class="infoCalVal"> <%= tot_co_val_label %> kg CO2e </span><span class="infoCalLeb">since <%= fullMonths[newGhgDt[0].repo_month] %></span></button>
                                                                                                                    </h5>
                                                                                                                </div>
                                                                                                                <div class="collapse" id="s2_cal_<%= sc %>" aria-labelledby="s2_cal_<%= sc %>" data-bs-parent="#accordionoc">
                                                                                                                    <div class="row p-2">
                                                                                                                        <div class="col-md-6 m-t-10">
                                                                                                                            <label class="form-label float-start" for="type_id_s2_<%= sc %>"><%= lang.report_edit.tab4.emi_sour %></label>
                                                                                                                            <select class="form-select emission_source" id="type_id_s2_<%= sc %>" name="type_id" required="" onchange="changeTypeId('s2','<%= sc %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                                <option selected="" value=""><%= lang.report_edit.tab4.emi_sour_sel %></option>
                                                                                                                                <% if(type_list.length > 0){
                                                                                                                                    type_list.forEach(dt => { 
                                                                                                                                        var selected = '';
                                                                                                                                        if(dt.scope == 2){
                                                                                                                                            if(newGhgDt.length > 0)
                                                                                                                                                if(newGhgDt[0].sec_id == dt.id)
                                                                                                                                                    selected = 'selected'; %>
                                                                                                                                            <option value="<%= dt.id %>" dt-set="<%= dt.type %>" <%= selected %>><%= dt.type_name %></option>
                                                                                                                                    <% }})
                                                                                                                                } %>
                                                                                                                            </select>
                                                                                                                        </div>
                                                                                                                        <script>
                                                                                                                            $(document).ready(async function(){
                                                                                                                                await changeTypeId('s2','<%= sc %>', '<%= newGhgDt[0].act_id %>')
                                                                                                                                await changeActId('s2','<%= sc %>', '<%= newGhgDt[0].emi_type_id %>')
                                                                                                                            })
                                                                                                                        </script>
                                                                                                                        <div class="col-md-6 m-t-10">
                                                                                                                            <label class="form-label float-start" for="act_id_s2_<%= sc %>"><%= lang.report_edit.tab4.act %></label>
                                                                                                                            <select class="form-select" id="act_id_s2_<%= sc %>" name="act_id" required="" onchange="changeActId('s2','<%= sc %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                                <option selected="" value=""><%= lang.report_edit.tab4.act_sel %></option>
                                                                                                                                <% if(act_list.length > 0){
                                                                                                                                    act_list.forEach(dt => { 
                                                                                                                                        var selected = ''; %>
                                                                                                                                        <option value="<%= dt.id %>"><%= dt.act_name %></option>
                                                                                                                                    <% })
                                                                                                                                } %>
                                                                                                                            </select>
                                                                                                                        </div>
                                                                                                                        <div class="col-md-6 m-t-10">
                                                                                                                            <label class="form-label float-start" for="emi_type_id_s2_<%= sc %>"><%= lang.report_edit.tab4.emi_type %></label>
                                                                                                                            <select class="form-select" id="emi_type_id_s2_<%= sc %>" name="emi_type_id" required="" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                                <option selected="" value=""><%= lang.report_edit.tab4.emi_type_sel %></option>
                                                                                                                                <% if(emi_type.length > 0){
                                                                                                                                    emi_type.forEach(dt => { 
                                                                                                                                        var selected = ''; %>
                                                                                                                                        <option value="<%= dt.id %>"><%= dt.emi_name %></option>
                                                                                                                                    <% })
                                                                                                                                } %>
                                                                                                                            </select>
                                                                                                                        </div>
                                                                                                                        <div class="col-md-6 m-t-10">
                                                                                                                            <label class="form-label float-start" for="repo_period_s2_<%= sc %>"><%= lang.report_edit.tab4.repo_per %></label>
                                                                                                                            <select class="form-select" id="repo_period_s2_<%= sc %>" name="repo_period" required="" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                                <option selected="" value=""><%= lang.report_edit.tab4.repo_per_sel %></option>
                                                                                                                                <% if(year_list.length > 0){
                                                                                                                                    year_list.forEach(dt => { 
                                                                                                                                        var selected = '';
                                                                                                                                        if(newGhgDt.length > 0)
                                                                                                                                            if(newGhgDt[0].repo_period == dt)
                                                                                                                                                selected = 'selected'; %>
                                                                                                                                        <option value="<%= dt %>" <%= selected %>><%= dt %></option>
                                                                                                                                    <% })
                                                                                                                                } %>
                                                                                                                            </select>
                                                                                                                        </div>
                                                                                                                        <div class="col-md-6 m-t-10">
                                                                                                                            <label class="form-label float-start" for="strt_month_s2_<%= sc %>"><%= lang.report_edit.tab4.st_month %></label>
                                                                                                                            <select class="form-select" id="strt_month_s2_<%= sc %>" name="strt_month" required="" onchange="calSelectMonth('s2','<%= sc %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                                <option selected="" value=""><%= lang.report_edit.tab4.st_month_sel %></option>
                                                                                                                                <% var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                                                                                                                                if(months.length > 0){
                                                                                                                                    months.forEach(dt => { 
                                                                                                                                        var selected = '';
                                                                                                                                        if(newGhgDt.length > 0)
                                                                                                                                            if(newGhgDt[0].repo_month == dt)
                                                                                                                                                selected = 'selected'; %>
                                                                                                                                        <option value="<%= dt %>" <%= selected %>><%= dt %></option>
                                                                                                                                    <% })
                                                                                                                                } %>
                                                                                                                            </select>
                                                                                                                        </div>
                                                                                                                        <div class="col-md-12 m-t-10 table-responsive">
                                                                                                                            <table class="table table-bordered" id="cal_val_entry_table_s2_<%= sc %>">
                                                                                                                                <thead>
                                                                                                                                    <tr>
                                                                                                                                        <th><%= lang.report_edit.tab4.table.head1 %></th>
                                                                                                                                        <th><%= lang.report_edit.tab4.table.head2 %></th>
                                                                                                                                        <th><%= lang.report_edit.tab4.table.head3 %></th>
                                                                                                                                        <th><%= lang.report_edit.tab4.table.head4 %></th>
                                                                                                                                        <th><%= lang.report_edit.tab4.table.head5 %></th>
                                                                                                                                    </tr>
                                                                                                                                </thead>
                                                                                                                                <tbody>
                                                                                                                                    <% if(newGhgDt.length > 0){
                                                                                                                                        var nextCalField = 1;
                                                                                                                                        var tot_cal_val = 0,
                                                                                                                                            tot_co_val = 0;
                                                                                                                                        newGhgDt.forEach(gdt => {
                                                                                                                                            gdt.cal_val > 0 ? tot_cal_val += gdt.cal_val : ''
                                                                                                                                            gdt.co_val > 0 ? tot_co_val += gdt.co_val : ''
                                                                                                                                            %>
                                                                                                                                            <tr>
                                                                                                                                                <td><%= gdt.repo_month %></td>
                                                                                                                                                <td>
                                                                                                                                                    <select class="form-select" id="emi_type_unit_id_s2_<%= nextCalField %>_<%= sc %>" name="emi_type_unit_id" cal-unit-id="<%= gdt.emi_type_unit_id %>" required="" onchange="setCalVal('s2', '<%= sc %>', '<%= nextCalField %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                                                        <option selected="" value="">Please select unit of measurement</option>
                                                                                                                                                    </select>
                                                                                                                                                </td>
                                                                                                                                                <td><input class="form-control" id="cal_val_s2_<%= nextCalField %>_<%= sc %>" name="cal_val" type="text" value="<%= gdt.cal_val %>" required="" onchange="setCoVal('s2', '<%= sc %>', '<%= nextCalField %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>></td>
                                                                                                                                                <td><input class="form-control" id="emi_fact_val_s2_<%= nextCalField %>_<%= sc %>" name="emi_fact_val" type="text" value="<%= gdt.emi_fact_val %>" required="" readonly></td>
                                                                                                                                                <td><input class="form-control" id="co_val_s2_<%= nextCalField %>_<%= sc %>" name="co_val" type="text" value="<%= gdt.co_val %>" required="" readonly onchange="setCoVal('s2', '<%= sc %>', '<%= nextCalField %>')"></td>
                                                                                                                                            </tr>
                                                                                                                                            <script>
                                                                                                                                                $(document).ready(async function(){
                                                                                                                                                    await calUnitSet('s2', '<%= sc %>', true, '<%= nextCalField %>', {type_id: '<%= newGhgDt[0].sec_id %>', act_id: '<%= newGhgDt[0].act_id%>', emi_type_id: '<%= newGhgDt[0].emi_type_id%>', year: '<%= newGhgDt[0].repo_month %>'})
                                                                                                                                                })
                                                                                                                                            </script>
                                                                                                                                        <%  nextCalField++; }) %> 
                                                                                                                                            <!-- <tr>
                                                                                                                                                <td colspan="2">Total</td>
                                                                                                                                                <td><span id="tot_cal_val_s2_<%# sc %>"><%# tot_cal_val %></span></td>
                                                                                                                                                <td></td>
                                                                                                                                                <td><span id="tot_co_val_s2_<%# sc %>"><%# tot_co_val %></span></td>
                                                                                                                                            </tr> -->
                                                                                                                                    <% } %>
                                                                                                                                </tbody>
                                                                                                                            </table>
                                                                                                                            <div class="container cal-tot-div">
                                                                                                                                <p class="tot-cal-val"><%= tot_co_val %> Kg of CO2e</p>
                                                                                                                            </div>
                                                                                                                        </div>
                                                                                                                        <% if(user_type != 'V'){ %>
                                                                                                                
                                                                                                                            <div class="col-md-10 m-t-10">
                                                                                                                                <button class="btn btn-pill btn-custom float-end text-center" data-bs-original-title title="Save" onclick="saveCalValue('s2','<%= sc %>')"><i class="icofont icofont-save"> <%= lang.report_edit.tab4.save_btn %></i></button>
                                                                                                                    
                                                                                                                            </div>
                                                                                                                            <div class="col-md-2 m-t-10">
                                                                                                                                <button class="btn btn-pill btn-custom float-right" data-bs-original-title title="delete" onclick=""><i class="icofont icofont-ui-delete"><%= lang.report_edit.tab4.del_btn %></i></button>
                                                                                                                            </div>
                                                                                                                        <% } %>
                                                                                                                    </div>
                                                                                                                </div>
                                                                                                            </div>
                                                                                                        <% } %>
                                                                                                        <%
                                                                                                    }
                                                                                                }else{ %>
                                                                                                    <div class="row">
                                                                                                        <div class="col-md-6 m-t-10">
                                                                                                            <label class="form-label float-start" for="type_id_s2_1"><%= lang.report_edit.tab4.emi_sour %></label>
                                                                                                            <select class="form-select emission_source" id="type_id_s2_1" name="type_id" required="" onchange="changeTypeId('s2',1)" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                <option selected="" value=""><%= lang.report_edit.tab4.emi_sour_sel %></option>
                                                                                                                <% if(type_list.length > 0){
                                                                                                                    type_list.forEach(dt => { 
                                                                                                                        if(dt.scope == 2){
                                                                                                                            var selected = ''; %>
                                                                                                                            <option value="<%= dt.id %>" dt-set="<%= dt.type %>"><%= dt.type_name %></option>
                                                                                                                    <% }})
                                                                                                                } %>
                                                                                                            </select>
                                                                                                        </div>
                                                                                                        <div class="col-md-6 m-t-10">
                                                                                                            <label class="form-label float-start" for="act_id_s2_1"><%= lang.report_edit.tab4.act %></label>
                                                                                                            <select class="form-select" id="act_id_s2_1" name="act_id" required="" onchange="changeActId('s2',1)" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                <option selected="" value=""><%= lang.report_edit.tab4.act_sel %></option>
                                                                                                                <% if(act_list.length > 0){
                                                                                                                    act_list.forEach(dt => { 
                                                                                                                        var selected = ''; %>
                                                                                                                        <option value="<%= dt.id %>"><%= dt.act_name %></option>
                                                                                                                    <% })
                                                                                                                } %>
                                                                                                            </select>
                                                                                                        </div>
                                                                                                        <div class="col-md-6 m-t-10">
                                                                                                            <label class="form-label float-start" for="emi_type_id_s2_1"><%= lang.report_edit.tab4.emi_type %></label>
                                                                                                            <select class="form-select" id="emi_type_id_s2_1" name="emi_type_id" required="" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                <option selected="" value=""><%= lang.report_edit.tab4.emi_type_sel %></option>
                                                                                                                <% if(emi_type.length > 0){
                                                                                                                    emi_type.forEach(dt => { 
                                                                                                                        var selected = ''; %>
                                                                                                                        <option value="<%= dt.id %>"><%= dt.emi_name %></option>
                                                                                                                    <% })
                                                                                                                } %>
                                                                                                            </select>
                                                                                                        </div>
                                                                                                        <div class="col-md-6 m-t-10">
                                                                                                            <label class="form-label float-start" for="repo_period_s2_1"><%= lang.report_edit.tab4.repo_per %></label>
                                                                                                            <select class="form-select" id="repo_period_s2_1" name="repo_period" required="" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                <option selected="" value=""><%= lang.report_edit.tab4.repo_per_sel %></option>
                                                                                                                <% if(year_list.length > 0){
                                                                                                                    year_list.forEach(dt => { 
                                                                                                                        var selected = ''; %>
                                                                                                                        <option value="<%= dt %>"><%= dt %></option>
                                                                                                                    <% })
                                                                                                                } %>
                                                                                                            </select>
                                                                                                        </div>
                                                                                                        <div class="col-md-6 m-t-10">
                                                                                                            <label class="form-label float-start" for="strt_month_s2_1"><%= lang.report_edit.tab4.st_month %></label>
                                                                                                            <select class="form-select" id="strt_month_s2_1" name="strt_month" required="" onchange="calSelectMonth('s2',1)" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                <option selected="" value=""><%= lang.report_edit.tab4.st_month_sel %></option>
                                                                                                                <% var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                                                                                                                if(months.length > 0){
                                                                                                                    months.forEach(dt => { 
                                                                                                                        var selected = ''; %>
                                                                                                                        <option value="<%= dt %>"><%= dt %></option>
                                                                                                                    <% })
                                                                                                                } %>
                                                                                                            </select>
                                                                                                        </div>
                                                                                                        <div class="col-md-12 m-t-10 table-responsive">
                                                                                                            <table class="table table-bordered" id="cal_val_entry_table_s2_1">
                                                                                                                <thead>
                                                                                                                    <tr>
                                                                                                                        <th><%= lang.report_edit.tab4.table.head1 %></th>
                                                                                                                        <th><%= lang.report_edit.tab4.table.head2 %></th>
                                                                                                                        <th><%= lang.report_edit.tab4.table.head3 %></th>
                                                                                                                        <th><%= lang.report_edit.tab4.table.head4 %></th>
                                                                                                                        <th><%= lang.report_edit.tab4.table.head5 %></th>
                                                                                                                    </tr>
                                                                                                                </thead>
                                                                                                                <tbody></tbody>
                                                                                                            </table>
                                                                                                        </div>
                                                                                                        <% if(user_type != 'V'){ %>
                                                                                                            <div class="col-md-8"></div>
                                                                                                            <div class="col-md-4 m-t-10">
                                                                                                                <button class="btn btn-pill btn-custom float-end text-center" data-bs-original-title title="Save" onclick="saveCalValue('s2',1)"><i class="icofont icofont-save"> <%= lang.report_edit.tab4.save_btn %></i></button>
                                                                                                            </div>
                                                                                                        <% } %>
                                                                                                    </div>
                                                                                                <% } %>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-12">
                                                                        <div class="default-according style-2" id="inghg">
                                                                    <div class="card custom-span-card m-b-10">
                                                                        <div class="card-header caruBackCol1 text-center">
                                                                            <h5 class="mb-0">
                                                                                <button class="btn btn-link" data-bs-toggle="collapse" data-bs-target="#scope_3" aria-expanded="true" aria-controls="collapse11"><%= lang.report_edit.tab4.scope3 %></button>
                                                                            </h5>
                                                                        </div>
                                                                        <div class="collapse" id="scope_3" aria-labelledby="scope_3" data-bs-parent="#accordionoc">
                                                                            <div class="row">
                                                                                <div class="col-md-12 text-center p-3 row">
                                                                                    <div class="col-md-12 row mt-1">
                                                                                        <div class="col-md-6"></div>
                                                                                        <% if(user_type != 'V'){ %>
                                                                                            <div class="col-md-6">
                                                                                                <button class="btn btn-pill btn-sm btn-custom float-end text-center" data-bs-original-title title="Add New Calculator" onclick="AddCal('s3')"><i class="icofont icofont-ui-add"></i><span>&nbsp;&nbsp;<%= lang.report_edit.tab4.add_btn %></span></button>
                                                                                            </div>
                                                                                        <% } %>
                                                                                    </div>
                                                                                    <div class="col-md-12 m-t-10 p-l-20 p-r-20" id="calDetails_s3">
                                                                                        <% if('s3' in ghg_emi_data){
                                                                                            var sc_len = ghg_emi_data['s3'].length / 12;
                                                                                            for(let sc = 1; sc <= sc_len; sc++){
                                                                                                var newGhgDt = ghg_emi_data['s3'].filter(dt => dt.sl_no == sc && dt.scope == 's3')      
                                                                                                if(newGhgDt.length > 0){ 
                                                                                                    var tot_co_val_label = 0;
                                                                                                    newGhgDt.forEach(dt => tot_co_val_label += dt.co_val)
                                                                                                    var fullMonths = {'Jan': 'January', 'Feb': 'February', 'Mar': 'March', 'Apr': 'April', 'May': 'May', 'Jun': 'June', 'Jul': 'July', 'Aug': 'August', 'Sep': 'September', 'Oct': 'October', 'Nov': 'November', 'Dec': 'December'};
                                                                                                    %>
                                                                                                    <div class="card">
                                                                                                        <div class="card-header caruBackCol1">
                                                                                                            <h5 class="mb-0">
                                                                                                                <button class="btn btn-link" data-bs-toggle="collapse" data-bs-target="#s3_cal_<%= sc %>" aria-expanded="true" aria-controls="collapse11"><span class="infoCalLeb"><%= newGhgDt[0].type_name %> - <%= newGhgDt[0].act_name %> - <%= newGhgDt[0].emi_name %> -</span><span class="infoCalVal"> <%= tot_co_val_label %> kg CO2e </span><span class="infoCalLeb">since <%= fullMonths[newGhgDt[0].repo_month] %></span></button>
                                                                                                            </h5>
                                                                                                        </div>
                                                                                                        <div class="collapse" id="s3_cal_<%= sc %>" aria-labelledby="s3_cal_<%= sc %>" data-bs-parent="#accordionoc">
                                                                                                            <div class="row">
                                                                                                                <div class="col-md-6 m-t-10">
                                                                                                                    <label class="form-label float-start" for="type_id_s3_<%= sc %>"><%= lang.report_edit.tab4.emi_sour %></label>
                                                                                                                    <select class="form-select emission_source" id="type_id_s3_<%= sc %>" name="type_id" required="" <%= user.user_type != 'V' ? '' : 'disabled' %> onchange="changeTypeId('s3','<%= sc %>')">
                                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.emi_sour_sel %></option>
                                                                                                                        <% if(type_list.length > 0){
                                                                                                                            type_list.forEach(dt => { 
                                                                                                                                var selected = '';
                                                                                                                                if(dt.scope == 3){
                                                                                                                                if(newGhgDt.length > 0)
                                                                                                                                    if(newGhgDt[0].sec_id == dt.id)
                                                                                                                                        selected = 'selected'; %>
                                                                                                                                <option value="<%= dt.id %>" dt-set="<%= dt.type %>" <%= selected %>><%= dt.type_name %></option>
                                                                                                                            <% }})
                                                                                                                        } %>
                                                                                                                    </select>
                                                                                                                </div>
                                                                                                                <script>
                                                                                                                    $(document).ready(async function(){
                                                                                                                        await changeTypeId('s3','<%= sc %>', '<%= newGhgDt[0].act_id %>')
                                                                                                                        await changeActId('s3','<%= sc %>', '<%= newGhgDt[0].emi_type_id %>')
                                                                                                                    })
                                                                                                                </script>
                                                                                                                <div class="col-md-6 m-t-10">
                                                                                                                    <label class="form-label float-start" for="act_id_s3_<%= sc %>"><%= lang.report_edit.tab4.act %></label>
                                                                                                                    <select class="form-select" id="act_id_s3_<%= sc %>" name="act_id" required="" <%= user.user_type != 'V' ? '' : 'disabled' %> onchange="changeActId('s3','<%= sc %>')">
                                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.act_sel %></option>
                                                                                                                        <% if(act_list.length > 0){
                                                                                                                            act_list.forEach(dt => { 
                                                                                                                                var selected = ''; %>
                                                                                                                                <option value="<%= dt.id %>"><%= dt.act_name %></option>
                                                                                                                            <% })
                                                                                                                        } %>
                                                                                                                    </select>
                                                                                                                </div>
                                                                                                                <div class="col-md-6 m-t-10">
                                                                                                                    <label class="form-label float-start" for="emi_type_id_s3_<%= sc %>"><%= lang.report_edit.tab4.emi_type %></label>
                                                                                                                    <select class="form-select" id="emi_type_id_s3_<%= sc %>" name="emi_type_id" required="" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.emi_type_sel %></option>
                                                                                                                        <% if(emi_type.length > 0){
                                                                                                                            emi_type.forEach(dt => { 
                                                                                                                                var selected = ''; %>
                                                                                                                                <option value="<%= dt.id %>"><%= dt.emi_name %></option>
                                                                                                                            <% })
                                                                                                                        } %>
                                                                                                                    </select>
                                                                                                                </div>
                                                                                                                <div class="col-md-6 m-t-10">
                                                                                                                    <label class="form-label float-start" for="repo_period_s3_<%= sc %>"><%= lang.report_edit.tab4.repo_per %></label>
                                                                                                                    <select class="form-select" id="repo_period_s3_<%= sc %>" name="repo_period" required="" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.repo_per_sel %></option>
                                                                                                                        <% if(year_list.length > 0){
                                                                                                                            year_list.forEach(dt => { 
                                                                                                                                var selected = '';
                                                                                                                                if(newGhgDt.length > 0)
                                                                                                                                    if(newGhgDt[0].repo_period == dt)
                                                                                                                                        selected = 'selected'; %>
                                                                                                                                <option value="<%= dt %>" <%= selected %>><%= dt %></option>
                                                                                                                            <% })
                                                                                                                        } %>
                                                                                                                    </select>
                                                                                                                </div>
                                                                                                                <div class="col-md-6 m-t-10">
                                                                                                                    <label class="form-label float-start" for="strt_month_s3_<%= sc %>"><%= lang.report_edit.tab4.st_month %></label>
                                                                                                                    <select class="form-select" id="strt_month_s3_<%= sc %>" name="strt_month" required="" onchange="calSelectMonth('s3','<%= sc %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.st_month_sel %></option>
                                                                                                                        <% var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                                                                                                                        if(months.length > 0){
                                                                                                                            months.forEach(dt => { 
                                                                                                                                var selected = '';
                                                                                                                                if(newGhgDt.length > 0)
                                                                                                                                    if(newGhgDt[0].repo_month == dt)
                                                                                                                                        selected = 'selected'; %>
                                                                                                                                <option value="<%= dt %>" <%= selected %>><%= dt %></option>
                                                                                                                            <% })
                                                                                                                        } %>
                                                                                                                    </select>
                                                                                                                </div>
                                                                                                                <div class="col-md-12 m-t-10 table-responsive">
                                                                                                                    <table class="table table-bordered" id="cal_val_entry_table_s3_<%= sc %>">
                                                                                                                        <thead>
                                                                                                                            <tr>
                                                                                                                                <th><%= lang.report_edit.tab4.table.head1 %></th>
                                                                                                                                <th><%= lang.report_edit.tab4.table.head2 %></th>
                                                                                                                                <th><%= lang.report_edit.tab4.table.head3 %></th>
                                                                                                                                <th><%= lang.report_edit.tab4.table.head4 %></th>
                                                                                                                                <th><%= lang.report_edit.tab4.table.head5 %></th>
                                                                                                                            </tr>
                                                                                                                        </thead>
                                                                                                                        <tbody>
                                                                                                                            <% if(newGhgDt.length > 0){
                                                                                                                                var nextCalField = 1;
                                                                                                                                var tot_cal_val = 0,
                                                                                                                                    tot_co_val = 0;
                                                                                                                                newGhgDt.forEach(gdt => {
                                                                                                                                    gdt.cal_val > 0 ? tot_cal_val += gdt.cal_val : ''
                                                                                                                                    gdt.co_val > 0 ? tot_co_val += gdt.co_val : ''
                                                                                                                                    %>
                                                                                                                                    <tr>
                                                                                                                                        <td><%= gdt.repo_month %></td>
                                                                                                                                        <td>
                                                                                                                                            <select class="form-select" id="emi_type_unit_id_s3_<%= nextCalField %>_<%= sc %>" name="emi_type_unit_id" cal-unit-id="<%= gdt.emi_type_unit_id %>" required="" onchange="setCalVal('s3', '<%= sc %>', '<%= nextCalField %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                                                                <option selected="" value="">Please select unit of measurement</option>
                                                                                                                                            </select>
                                                                                                                                        </td>
                                                                                                                                        <td><input class="form-control" id="cal_val_s3_<%= nextCalField %>_<%= sc %>" name="cal_val" type="text" value="<%= gdt.cal_val %>" required="" onchange="setCoVal('s3', '<%= sc %>', '<%= nextCalField %>')" <%= user.user_type != 'V' ? '' : 'disabled' %>></td>
                                                                                                                                        <td><input class="form-control" id="emi_fact_val_s3_<%= nextCalField %>_<%= sc %>" name="emi_fact_val" type="text" value="<%= gdt.emi_fact_val %>" required="" readonly></td>
                                                                                                                                        <td><input class="form-control" id="co_val_s3_<%= nextCalField %>_<%= sc %>" name="co_val" type="text" value="<%= gdt.co_val %>" required="" readonly onchange="setCoVal('s3', '<%= sc %>', '<%= nextCalField %>')"></td>
                                                                                                                                    </tr>
                                                                                                                                    <script>
                                                                                                                                        $(document).ready(async function(){
                                                                                                                                            await calUnitSet('s3', '<%= sc %>', true, '<%= nextCalField %>', {type_id: '<%= newGhgDt[0].sec_id %>', act_id: '<%= newGhgDt[0].act_id%>', emi_type_id: '<%= newGhgDt[0].emi_type_id%>', year: '<%= newGhgDt[0].repo_month %>'})
                                                                                                                                        })
                                                                                                                                    </script>
                                                                                                                            <%  nextCalField++; }) %> 
                                                                                                                            <tr>
                                                                                                                                <td colspan="2">Total</td>
                                                                                                                                <td><span id="tot_cal_val_s3_<%= sc %>"><%= tot_cal_val %></span></td>
                                                                                                                                <td></td>
                                                                                                                                <td><span id="tot_co_val_s3_<%= sc %>"><%= tot_co_val %></span></td>
                                                                                                                            </tr>
                                                                                                                            <% } %>
                                                                                                                        </tbody>
                                                                                                                    </table>
                                                                                                                </div>
                                                                                                                <% if(user_type != 'V'){ %>
                                                                                                                    <div class="col-md-8"></div>
                                                                                                                    <div class="col-md-10 m-t-10">
                                                                                                                        <button class="btn btn-pill btn-custom float-end text-center" data-bs-original-title title="Save" onclick="saveCalValue('s3','<%= sc %>')"><i class="icofont icofont-save"> <%= lang.report_edit.tab4.save_btn %></i></button>
                                                                                                                    </div>
                                                                                                                    <div class="col-md-2 m-t-10">
                                                                                                                        <button class="btn btn-pill btn-custom float-right" data-bs-original-title title="delete" onclick=""><i class="icofont icofont-ui-delete"><%= lang.report_edit.tab4.del_btn %></i></button>
                                                                                                                    </div>
                                                                                                                <% } %>
                                                                                                            </div>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                <% } %>
                                                                                                <%
                                                                                            }
                                                                                        }else{ %>
                                                                                            <div class="row">
                                                                                                <div class="col-md-6 m-t-10">
                                                                                                    <label class="form-label float-start" for="type_id_s3_1"><%= lang.report_edit.tab4.emi_sour %></label>
                                                                                                    <select class="form-select emission_source" id="type_id_s3_1" name="type_id" required="" onchange="changeTypeId('s3',1)" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.emi_sour_sel %></option>
                                                                                                        <% if(type_list.length > 0){
                                                                                                            type_list.forEach(dt => { 
                                                                                                                if(dt.scope == 3){
                                                                                                                var selected = ''; %>
                                                                                                                <option value="<%= dt.id %>" dt-set="<%= dt.type %>"><%= dt.type_name %></option>
                                                                                                            <% }})
                                                                                                        } %>
                                                                                                    </select>
                                                                                                </div>
                                                                                                <div class="col-md-6 m-t-10">
                                                                                                    <label class="form-label float-start" for="act_id_s3_1"><%= lang.report_edit.tab4.act %></label>
                                                                                                    <select class="form-select" id="act_id_s3_1" name="act_id" required="" onchange="changeActId('s3',1)" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.act_sel %></option>
                                                                                                        <% if(act_list.length > 0){
                                                                                                            act_list.forEach(dt => { 
                                                                                                                var selected = ''; %>
                                                                                                                <option value="<%= dt.id %>"><%= dt.act_name %></option>
                                                                                                            <% })
                                                                                                        } %>
                                                                                                    </select>
                                                                                                </div>
                                                                                                <div class="col-md-6 m-t-10">
                                                                                                    <label class="form-label float-start" for="emi_type_id_s3_1"><%= lang.report_edit.tab4.emi_type %></label>
                                                                                                    <select class="form-select" id="emi_type_id_s3_1" name="emi_type_id" required="" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.emi_type_sel %></option>
                                                                                                        <% if(emi_type.length > 0){
                                                                                                            emi_type.forEach(dt => { 
                                                                                                                var selected = ''; %>
                                                                                                                <option value="<%= dt.id %>"><%= dt.emi_name %></option>
                                                                                                            <% })
                                                                                                        } %>
                                                                                                    </select>
                                                                                                </div>
                                                                                                <div class="col-md-6 m-t-10">
                                                                                                    <label class="form-label float-start" for="repo_period_s3_1"><%= lang.report_edit.tab4.repo_per %></label>
                                                                                                    <select class="form-select" id="repo_period_s3_1" name="repo_period" required="" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.repo_per_sel %></option>
                                                                                                        <% if(year_list.length > 0){
                                                                                                            year_list.forEach(dt => { 
                                                                                                                var selected = ''; %>
                                                                                                                <option value="<%= dt %>"><%= dt %></option>
                                                                                                            <% })
                                                                                                        } %>
                                                                                                    </select>
                                                                                                </div>
                                                                                                <div class="col-md-6 m-t-10">
                                                                                                    <label class="form-label float-start" for="strt_month_s3_1"><%= lang.report_edit.tab4.st_month %></label>
                                                                                                    <select class="form-select" id="strt_month_s3_1" name="strt_month" required="" onchange="calSelectMonth('s3',1)" <%= user.user_type != 'V' ? '' : 'disabled' %>>
                                                                                                        <option selected="" value=""><%= lang.report_edit.tab4.st_month_sel %></option>
                                                                                                        <% var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                                                                                                        if(months.length > 0){
                                                                                                            months.forEach(dt => { 
                                                                                                                var selected = ''; %>
                                                                                                                <option value="<%= dt %>"><%= dt %></option>
                                                                                                            <% })
                                                                                                        } %>
                                                                                                    </select>
                                                                                                </div>
                                                                                                <div class="col-md-12 m-t-10 table-responsive">
                                                                                                    <table class="table table-bordered" id="cal_val_entry_table_s3_1">
                                                                                                        <thead>
                                                                                                            <tr>
                                                                                                                <th><%= lang.report_edit.tab4.table.head1 %></th>
                                                                                                                <th><%= lang.report_edit.tab4.table.head2 %></th>
                                                                                                                <th><%= lang.report_edit.tab4.table.head3 %></th>
                                                                                                                <th><%= lang.report_edit.tab4.table.head4 %></th>
                                                                                                                <th><%= lang.report_edit.tab4.table.head5 %></th>
                                                                                                            </tr>
                                                                                                        </thead>
                                                                                                        <tbody></tbody>
                                                                                                    </table>
                                                                                                </div>
                                                                                                <% if(user_type != 'V'){ %>
                                                                                                    <div class="col-md-8"></div>
                                                                                                    <div class="col-md-4 m-t-10">
                                                                                                        <button class="btn btn-pill btn-custom float-end text-center" data-bs-original-title title="Save" onclick="saveCalValue('s3',1)"><i class="icofont icofont-save"> <%= lang.report_edit.tab4.save_btn %></i></button>
                                                                                                    </div>
                                                                                                <% } %>
                                                                                            </div>
                                                                                        <% } %>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                <!-- </div>
                                            </div>
                                        </div>
                                    </div>
                                </div> -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" name="sec_id" id="sec_id" value="<%= sec_id %>">
<input type="hidden" name="ind_id" id="ind_id" value="<%= ind_id %>">
<input type="hidden" name="top_id" id="top_id" value="<%= top_id %>">
<input type="hidden" name="project_id" id="project_id" value="<%= project_id %>">
<input type="hidden" name="cal_lang_flag" id="cal_lang_flag" value="<%= cal_lang_flag %>">

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.2.61/jspdf.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js" integrity="sha512-a9NgEEK7tsCvABL7KqtUTQjl69z7091EVPpw5KxPlZ93T141ffe1woLtbXTX+r2/8TtTvRX/v4zTL2UlMUPgwg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- <script>
    function downloadPrf(divId){
        var divToPrint = document.getElementById(divId);
        var doc = new jsPDF();
        doc.fromHTML(`<html><head><title>Test</title></head><body style="width:100%;">` + divToPrint.innerHTML + `</body></html>`);
        doc.save('div.pdf');
        // html2canvas(divToPrint, {
        //   scale: 2 // Adjust the scale as needed for better quality
        // }).then(function(canvas) {
        //   const pdf = new jsPDF("p", "mm", "a4");
        //   pdf.addImage(canvas.toDataURL("image/png"), "PNG", 0, 0, pdf.internal.pageSize.getWidth(), pdf.internal.pageSize.getHeight());
        //   pdf.save("output.pdf");
        // });
    }
</script> -->

<!-- <script>
var collapseElementList = [].slice.call(document.querySelectorAll('.collapse'))
var collapseList = collapseElementList.map(function (collapseEl) {
    return new bootstrap.Collapse(collapseEl)
})
</script> -->


<script>
    $(document).ready(function(){
        var reportType = '<%= repo_type %>';
        // console.log(reportType);
        $('.u-step').each(function(){
            if($(this).attr('dt-for').trim().split(' ').join('').toLowerCase() != reportType){
                $(this).removeClass('done')
                $(this).addClass('disabled')
            }
            else
                $(this).addClass('done')
        })
    })
</script>

<script>
    function downloadPrf(divId, title){
        var divToPrint = document.getElementById(divId);
        $.ajax({
            method: "POST",
            url: "/download_pdf",
            data: { pdfDiv: divToPrint.innerHTML },
            xhrFields: {
                responseType: 'blob' // Receive response as a binary blob
            },
            beforeSend: function () {
                $(".loader-wrapper").show();
            },
            success: function (data) {
            // Create a Blob URL for the PDF
                const pdfUrl = URL.createObjectURL(data);

                // Create an anchor element for downloading the PDF
                const a = document.createElement('a');
                a.href = pdfUrl;
                a.download = `${title}_${new Date().getTime()}.pdf`; // Set the desired filename
                a.style.display = 'none';

                // Append the anchor to the document body and trigger a click event
                document.body.appendChild(a);
                a.click();

                // Cleanup: Remove the anchor and revoke the Blob URL
                document.body.removeChild(a);
                URL.revokeObjectURL(pdfUrl);
            },
            error: function (xhr, status, error) {
                console.error('Error:', error);
            },
            complete: function () {
                $(".loader-wrapper").hide();
            }
        })
    }
</script>
  

<script>
    function AddEditor(){
        var editorLength = $('.colEditor').length
        $('#editorDiv').append(`
        <div id="editorNewDiv_${editorLength+1}" class="row">
            <div class="col-md-12 m-3 row">
                <div class="col-md-1">
                    <label for="" class="mb-3"> Title</label>
                </div>
                <div class="col-md-7">
                    <input class="form-control" type="text" name="editor_topic" id="editor_topic_${editorLength+1}" placeholder="Enter Title">
                </div>
                <div class="col-md-12 colEditor m-t-15">
                    <div id="div_editor_${editorLength+1}"></div>
                </div>
            </div>
            <div class="col-md-8">&nbsp;</div>
            <div class="col-md-2">
                <button class="btn btn-pill btn-custom float-end text-center" data-bs-original-title title="Save" onclick="saveEditorValue(${editorLength+1}, 0)"><i class="icofont icofont-save">&nbsp;&nbsp; Save</i></button>
            </div>
            <div class="col-md-2">
                <button class="btn btn-pill btn-custom float-end ml-2 text-center" data-bs-original-title title="Save" onclick="deleteEdotor(${editorLength+1})"><i class="icofont icofont-trash">&nbsp;&nbsp; Delete</i></button>
            </div>
        </div>
        `)
        console.log(`div_editor_${editorLength+1}`, 'HEHEHEHEEHEHE');
        editorList[`div_editor_${editorLength+1}`] = new RichTextEditor(`#div_editor_${editorLength+1}`);
    }
</script>




<script>
    function deleteEdotor(id){
        $('#editorNewDiv_'+id).remove()
    }
</script>

<script>
    function saveEditorValue(id, top_id){
        var topicTitle = $('#editor_topic_'+id).val()
        var txtEditorVal = editorList['div_editor_'+id].getHTMLCode()
        // console.log(topicTitle, txtEditorVal);
        $.ajax({
            method:'POST',
            url: '/save_editor_data',
            data: {
                topicTilte: topicTitle, 
                txtEditorVal: txtEditorVal, 
                sec_id: $('#sec_id').val(), 
                ind_id: $('#ind_id').val(), 
                top_id: top_id,
                project_id: $('#project_id').val(),
                flag: '<%= flag %>'
            },
            dataType: 'html',
            beforeSend: function(){
                // $('.loader-wrapper').show()
            },
            success: function(result){
                var res = JSON.parse(result);
                
            },
            complete: function(){
                $('.loader-wrapper').hide()
            }
        })
    }
</script>
<script>
    const increseCount = (dt, id) => {
        // console.log(dt, 'dt');
        var totCountVal = totCount[id]
        var dataSet = wordList[id].trim().split(',')
        dataSet = dataSet.map(dt => dt.trim().toLowerCase());
        // console.log(totCountVal, 'totCountVal');
        // console.log(dataSet.includes(dt.trim().split('\n').join('').toLowerCase()), 'sadasd', dt);
        if(dataSet.includes(dt.trim().split('\n').join('').toLowerCase())){
            totCountVal += 1
            totCount[id] = totCountVal
            $(`#countMatchNum_${id}`).text(`${totCountVal}`)
            return dt.trim().split('\n').join('').toLowerCase().split(' ').join('');
        }
    }
</script>
<script>
    function changeTypeId(scope, id, act_id = 0){
        $(`label[for="emi_type_id_${scope}_${id}"]`).text($(`#type_id_${scope}_${id}`).attr('dt-set'))
        $.ajax({
            method:'POST',
            url: '/get_cal_act_ajax',
            data: {type_id: $(`#type_id_${scope}_${id}`).val(), flag: $('#cal_lang_flag').val() != 'B' ? $('#cal_lang_flag').val() : 'E'},
            dataType: 'html',
            beforeSend: function(){
                // $('.loader-wrapper').show()
            },
            success: function(result){
                var res = JSON.parse(result);
                // console.log(res);
                $(`#act_id_${scope}_${id}`).empty();
                $(`#act_id_${scope}_${id}`).append($('<option>', {value: '', text: 'Select Activity'}));
                if(res.suc > 0 && res.msg.length > 0){
                    $.each(res.msg, function (i, item) {
                        var _selected = false
                        if(act_id > 0)
                            if(act_id == item.id)
                                _selected = true;
                        $(`#act_id_${scope}_${id}`).append($('<option>', {value: item.id, text: item.act_name, selected: _selected}));
                    });
                }
            },
            complete: function(){
                $('.loader-wrapper').hide()
            }
        })
    }
</script>
<script>
    function changeActId(scope, id, emi_type_id = 0){
        $.ajax({
            method:'POST',
            url: '/get_cal_emi_type_ajax',
            data: {type_id: $(`#type_id_${scope}_${id}`).val(), act_id: $(`#act_id_${scope}_${id}`).val(), flag: $('#cal_lang_flag').val() != 'B' ? $('#cal_lang_flag').val() : 'E'},
            dataType: 'html',
            beforeSend: function(){
                $('.loader-wrapper').hide()
            },
            success: function(result){
                var res = JSON.parse(result);
                // console.log(res);
                $(`#emi_type_id_${scope}_${id}`).empty();
                $(`#emi_type_id_${scope}_${id}`).append($('<option>', {value: '', text: 'Select One'}));
                if(res.suc > 0 && res.msg.length > 0){
                    $.each(res.msg, function (i, item) {
                        var _selected = false
                        if(emi_type_id > 0)
                            if(emi_type_id == item.id)
                                _selected = true;
                        $(`#emi_type_id_${scope}_${id}`).append($('<option>', {value: item.id, text: item.emi_name, selected: _selected}));
                    });
                }
            },
            complete: function(){
                $('.loader-wrapper').hide()
            }
        })
    }
</script>
<script>
    function calUnitSet(scope, id, prePoulate = false, month = 0, data={}){
        // console.log(scope, id, prePoulate, month, {type_id: $(`#type_id_${scope}_${id}`).val(), act_id: $(`#act_id_${scope}_${id}`).val(), emi_type_id: $(`#emi_type_id_${scope}_${id}`).val(), year: $(`#repo_period_${scope}_${id}`).val()});
        $.ajax({
            method:'POST',
            url: '/get_cal_unit_list_ajax',
            data: {type_id: prePoulate ? data.type_id : $(`#type_id_${scope}_${id}`).val(), act_id: prePoulate ? data.act_id : $(`#act_id_${scope}_${id}`).val(), emi_type_id: prePoulate ? data.emi_type_id : $(`#emi_type_id_${scope}_${id}`).val(), year: prePoulate ? data.year : $(`#repo_period_${scope}_${id}`).val(), flag: $('#cal_lang_flag').val() != 'B' ? $('#cal_lang_flag').val() : 'E'},
            dataType: 'html',
            beforeSend: function(){
                // $('.loader-wrapper').show()
            },
            success: function(result){
                var res = JSON.parse(result);
                if(!prePoulate){
                    for(let idt = 1; idt <= 12; idt++){
                        $(`#emi_type_unit_id_${scope}_${idt}_${id}`).empty()
                        $(`#cal_val_${scope}_${idt}_${id}`).val('')
                        $(`#emi_fact_val_${scope}_${idt}_${id}`).val('')
                        $(`#co_val_${scope}_${idt}_${id}`).val('')
                        $(`#emi_type_unit_id_${scope}_${idt}_${id}`).append($('<option>', {value: '', text: 'Please select unit of measurement'}));
                        if(res.suc > 0 && res.msg.length > 0){
                            $.each(res.msg, function (i, item) {
                                $(`#emi_type_unit_id_${scope}_${idt}_${id}`).append($('<option>', {value: item.unit_id, text: item.unit_name, dt_set: item.co_val}));
                            });
                        }
                    }
                }else{
                    if(res.suc > 0 && res.msg.length > 0){
                        // console.log(res.msg, `#emi_type_unit_id_${scope}_${month}_${id}`);
                        $.each(res.msg, function (i, item) {
                            var _selected = false
                            if($(`#emi_type_unit_id_${scope}_${month}_${id}`).attr('cal-unit-id') == item.unit_id)
                                _selected = true
                            $(`#emi_type_unit_id_${scope}_${month}_${id}`).append($('<option>', {value: item.unit_id, text: item.unit_name, dt_set: item.co_val, selected: _selected}));
                        });
                    }
                }
            },
            complete: function(){
                $('.loader-wrapper').hide()
            }
        })
    }
    function setCalVal(scope, id, month){
        // console.log($(`#emi_type_unit_id_${month}_${id} :selected`).attr('dt_set'));
        $(`#emi_fact_val_${scope}_${month}_${id}`).val($(`#emi_type_unit_id_${scope}_${month}_${id} :selected`).attr('dt_set')).attr('readonly', 'readonly')

        var calVal = $(`#cal_val_${scope}_${month}_${id}`).val() > 0 ? $(`#cal_val_${scope}_${month}_${id}`).val() * $(`#emi_fact_val_${scope}_${month}_${id}`).val() : $(`#emi_fact_val_${scope}_${month}_${id}`).val()
        $(`#co_val_${scope}_${month}_${id}`).val(calVal.toFixed(2)).attr('readonly', 'readonly')
    }
    function setCoVal(scope, id, month){
        var calVal = $(`#cal_val_${scope}_${month}_${id}`).val() * $(`#emi_fact_val_${scope}_${month}_${id}`).val()
        $(`#co_val_${scope}_${month}_${id}`).val(calVal.toFixed(2)).attr('readonly', 'readonly')
        var tot_cal_val = 0, tot_co_val = 0;
        for(let idt = 1; idt <= 12; idt++){
            tot_cal_val += parseFloat($(`#cal_val_${scope}_${idt}_${id}`).val()) > 0 ? parseFloat($(`#cal_val_${scope}_${idt}_${id}`).val()) : 0;
            tot_co_val += parseFloat($(`#co_val_${scope}_${idt}_${id}`).val()) > 0 ? parseFloat($(`#co_val_${scope}_${idt}_${id}`).val()) : 0
        }
        $(`#tot_cal_val_${scope}_${id}`).text(tot_cal_val)
        $(`#tot_co_val_${scope}_${id}`).text(parseFloat(tot_co_val).toFixed(2))
    }
</script>
<script>
    function AddCal(scope){
        var scope_id = scope.split('')[1]
        var totCalFields = $(`#calDetails_${scope} table`).length,
            nextCalField = totCalFields + 1;
        $(`#calDetails_${scope}`).prepend(`
        <hr class="calSeparetor">
        <div class="row m-t-15">
            <div class="col-md-6 m-t-10">
                <label class="form-label float-start" for="type_id_${scope}_${nextCalField}"><%= lang.report_edit.tab4.emi_sour %></label>
                <select class="form-select emission_source" id="type_id_${scope}_${nextCalField}" name="type_id" required="" onchange="changeTypeId('${scope}', ${nextCalField})">
                    <option selected="" value=""><%= lang.report_edit.tab4.emi_sour_sel %></option>
                    <% if(type_list.length > 0){
                        type_list.forEach(dt => { 
                            var selected = ''; %>
                            <option value="<%= dt.id %>" dt-set="<%= dt.type %>"><%= dt.type_name %></option>
                        <% })
                    } %>
                </select>
            </div>
            <div class="col-md-6 m-t-10">
                <label class="form-label float-start" for="act_id_${scope}_${nextCalField}"><%= lang.report_edit.tab4.act %></label>
                <select class="form-select" id="act_id_${scope}_${nextCalField}" name="act_id" required="" onchange="changeActId('${scope}', ${nextCalField})">
                    <option selected="" value=""><%= lang.report_edit.tab4.act_sel %></option>
                    <% if(act_list.length > 0){
                        act_list.forEach(dt => { 
                            var selected = ''; %>
                            <option value="<%= dt.id %>"><%= dt.act_name %></option>
                        <% })
                    } %>
                </select>
            </div>
            <div class="col-md-6 m-t-10">
                <label class="form-label float-start" for="emi_type_id_${scope}_${nextCalField}"><%= lang.report_edit.tab4.emi_type %></label>
                <select class="form-select" id="emi_type_id_${scope}_${nextCalField}" name="emi_type_id" required="" onchange="calUnitSet('${scope}', ${nextCalField})">
                    <option selected="" value=""><%= lang.report_edit.tab4.emi_type_sel %></option>
                    <% if(emi_type.length > 0){
                        emi_type.forEach(dt => { 
                            var selected = ''; %>
                            <option value="<%= dt.id %>"><%= dt.emi_name %></option>
                        <% })
                    } %>
                </select>
            </div>
            <div class="col-md-6 m-t-10">
                <label class="form-label float-start" for="repo_period_${scope}_${nextCalField}"><%= lang.report_edit.tab4.repo_per %></label>
                <select class="form-select" id="repo_period_${scope}_${nextCalField}" name="repo_period" required="">
                    <option selected="" value=""><%= lang.report_edit.tab4.repo_per_sel %></option>
                    <% if(year_list.length > 0){
                        year_list.forEach(dt => { 
                            var selected = ''; %>
                            <option value="<%= dt %>"><%= dt %></option>
                        <% })
                    } %>
                </select>
            </div>
            <div class="col-md-6 m-t-10">
                <label class="form-label float-start" for="strt_month_${scope}_${nextCalField}"><%= lang.report_edit.tab4.st_month %></label>
                <select class="form-select" id="strt_month_${scope}_${nextCalField}" name="strt_month" required="" onchange="calSelectMonth('${scope}', ${nextCalField})">
                    <option selected="" value=""><%= lang.report_edit.tab4.st_month_sel %></option>
                    <% var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    if(months.length > 0){
                        months.forEach(dt => { 
                            var selected = ''; %>
                            <option value="<%= dt %>"><%= dt %></option>
                        <% })
                    } %>
                </select>
            </div>
            <div class="col-md-12 m-t-10 table-responsive">
                <table class="table table-bordered" id="cal_val_entry_table_${scope}_${nextCalField}">
                    <thead>
                        <tr>
                            <th><%= lang.report_edit.tab4.table.head1 %></th>
                            <th><%= lang.report_edit.tab4.table.head2 %></th>
                            <th><%= lang.report_edit.tab4.table.head3 %></th>
                            <th><%= lang.report_edit.tab4.table.head4 %></th>
                            <th><%= lang.report_edit.tab4.table.head5 %></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <% if(user_type != 'V'){ %>
                <div class="col-md-8"></div>
                <div class="col-md-4 m-t-10">
                    <button class="btn btn-pill btn-custom float-end text-center" data-bs-original-title title="Save" onclick="saveCalValue('${scope}',${nextCalField})"><i class="icofont icofont-save"> <%= lang.report_edit.tab4.save_btn %></i></button>
                </div>
            <% } %>
        </div>
        `)
    }
</script>
<script>
    function calSelectMonth(scope, id){
        var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        var selMonth = $(`#strt_month_${scope}_${id}`).val()
        var selMonthIndex = months.findIndex(dt => dt === selMonth)
        var monthCount = selMonthIndex,
        currMonth = [];
        for(let dt of months){
            if(monthCount > (months.length-1)){
                monthCount = 0
            }
            currMonth.push(months[monthCount])
            monthCount++;
        }
        createCalTable(scope, id, currMonth)
        calUnitSet(scope, id)

    }
    function createCalTable(scope, id, months){
        var nextCalField = 1
        $(`#cal_val_entry_table_${scope}_${id} tbody`).empty()
        for(let m of months){
            $(`#cal_val_entry_table_${scope}_${id} tbody`).append(`
            <tr>
                <td>${m}</td>
                <td>
                    <select class="form-select" id="emi_type_unit_id_${scope}_${nextCalField}_${id}" name="emi_type_unit_id" required="" onchange="setCalVal('${scope}', ${id}, '${nextCalField}')">
                        <option selected="" value="">Please select unit of measurement</option>
                        <% if(emi_type.length > 0){
                            emi_type.forEach(dt => { 
                                var selected = ''; %>
                                <option value="<%= dt.id %>"><%= dt.emi_name %></option>
                            <% })
                        } %>
                    </select>
                </td>
                <td><input class="form-control" id="cal_val_${scope}_${nextCalField}_${id}" name="cal_val" type="text" value="" required="" onchange="setCoVal('${scope}', ${id}, '${nextCalField}')"></td>
                <td><input class="form-control" id="emi_fact_val_${scope}_${nextCalField}_${id}" name="emi_fact_val" type="text" value="" required=""></td>
                <td><input class="form-control" id="co_val_${scope}_${nextCalField}_${id}" name="co_val" type="text" value="" required="" onchange="setCoVal('${scope}', ${id}, '${nextCalField}')"></td>
            </tr>
            `)
            nextCalField++;
        }
        $(`#cal_val_entry_table_${scope}_${id} tbody`).append(`
        <tr>
            <td colspan="2">Total</td>
            <td><span id="tot_cal_val_${scope}_${id}"></span></td>
            <td></td>
            <td><span id="tot_co_val_${scope}_${id}"></span></td>
        </tr>
        `)
    }
    function saveCalValue(scope, id){
        var type_id = $(`#type_id_${scope}_${id}`).val(),
        act_id = $(`#act_id_${scope}_${id}`).val(),
        emi_type_id = $(`#emi_type_id_${scope}_${id}`).val(),
        repo_period = $(`#repo_period_${scope}_${id}`).val();
        
        var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        var selMonth = $(`#strt_month_${scope}_${id}`).val()
        var selMonthIndex = months.findIndex(dt => dt === selMonth)
        var monthCount = selMonthIndex,
        currMonth = [];
        var req_data = [];
        for(let dt of months){
            if(monthCount > (months.length-1)){
                monthCount = 0
            }
            currMonth.push(months[monthCount])
            monthCount++;
        }
        // console.log(type_id,act_id,emi_type_id,repo_period,currMonth);
        var m_i = 1
        for(let dt of currMonth){
            req_data.push({month: dt, emi_type_unit_id: $(`#emi_type_unit_id_${scope}_${m_i}_${id}`).val(), cal_val: $(`#cal_val_${scope}_${m_i}_${id}`).val(), emi_fact_val: $(`#emi_fact_val_${scope}_${m_i}_${id}`).val(), co_val: $(`#co_val_${scope}_${m_i}_${id}`).val()})
            m_i++;
        }

        $.ajax({
            method:'POST',
            url: '/save_ghg_emi_val',
            data: {sl_no: id, scope, sec_id: type_id, act_id, emi_type_id, repo_period, req_data: JSON.stringify(req_data), proj_id: $('#project_id').val()},
            dataType: 'html',
            beforeSend: function(){
                $('.loader-wrapper').show()
            },
            success: function(result){
                var res = JSON.parse(result);
                if(res.suc > 0){
                    initiate_sweet_alert('', res.msg, res.suc == 1 ? 'success' : 'error')
                }
            },
            error: function(err){
                console.log(err);
            },
            complete: function(){
                $('.loader-wrapper').hide()
            }
        })
        // console.log(req_data);
    }
</script>
<script>
    // $(document).ready(function() {
    //     $('input[name="selSusDt"]').on('change', function(){
    //         // console.log($('input[name="selSusDt"]:checked'))
    //         $('.editorDiv').each(function(){
    //             $(this).hide()
    //         })
    //         $('input[name="selSusDt"]:checked').each(function(){
    //             var selVal = $(this).val()
    //             $('.editorDiv').each(function(){
    //                 if($(this).attr('data-code') == selVal)
    //                     $(this).show()
    //             })
    //             console.log($(this).val());
    //         })
    //     })
    // })
</script>
<script>
    $(document).ready(function(){
        var topMenu = $(".section-menu"),
        topMenuHeight = topMenu.outerHeight()+15
            // Bind to scroll
        $(window).scroll(function(){
        // Get container scroll position
        var fromTop = $(this).scrollTop();
        if ($(window).scrollTop() >= ($('.container-fluid .card-header').height() + $('.container-fluid .page-header').height() + $('.page-main-header').height() + $('.section-menu').height())) {
            // console.log('div reached');
            $('.section-menu').addClass('sticky-section-menu')
        }else{
            $('.section-menu').removeClass('sticky-section-menu')
        }                
        });
    })
</script>

<script>
    $('.nav-link[role="tab"]').on('click', function(e){
        console.log(e.target.id, 'lalala');
        var id = e.target.id, element = '', text = '', trigger_fung = false;
        switch (id) {
            case 'dis-top-tab':
                element = document.querySelector(`#${id}-row`)
                text = `Select disclosure topics.`
                trigger_fung = true
                break;
            case 'msg-dis-top-tab':
                element = document.querySelector(`.${id}-row`)
                text = `Here you can manage material sustainability topics.`
                trigger_fung = true
                break;
            case 'ghg-emi-tab':
                element = document.querySelector(`.${id}-row`)
                text = `Here, you can add your activities values to calculate the organisation’s GHG emissions.`
                trigger_fung = true
                break;
            default:
                trigger_fung = false
                break;
        }
        // if (trigger_fung)
        //     setTimeout(() => {
        //         triggerTour(element, text)
        //     }, 200);
    })
</script>

<script>
    $('.langContent').on('click', function(){
        $('.langContent').each(function(){
            $(this).removeClass('active');
        })
        $(this).toggleClass('active')
        var cal_flag = $(this).text() == 'English' ? 'E' : 'F'
        $('#cal_lang_flag').val(cal_flag)
        console.log($(this).text(), 'Enter Text');
        $.ajax({
            method:'GET',
            url: '/get_cal_emi_source_ajax',
            data: {flag: cal_flag},
            dataType: 'html',
            beforeSend: function(){
                $('.loader-wrapper').show()
            },
            success: function(result){
                var res = JSON.parse(result);
                console.log(res, res.suc > 0 && res.msg.length > 0);
                $('.emission_source').each(function () {
                    
                    var id = $(this).attr('id')
                    var id_arr = id.split('_')[2]
                    console.log(id_arr[1], id);
                    $(`#${id}`).empty()
                    $(`#${id}`).append($('<option>', {value: '', text: '<%= lang.report_edit.tab4.emi_sour_sel %>'}));
                    if(res.suc > 0 && res.msg.length > 0){
                        $.each(res.msg, function (i, item) {
                            if(item.scope == id_arr[1]){
                                console.log(item.type_name, item.scope == id_arr[1], item.scope, id_arr[1], 'In loop');
                                $(`#${id}`).append($('<option>', {value: item.id, text: item.type_name}));
                            }
                        });
                    }
                    // console.log($(this));
                })
            },
            error: function(err){
                console.log(err);
            },
            complete: function(){
                $('.loader-wrapper').hide()
            }
        })
    })


    
    window.onscroll = function() {myFunction()};
    
    var header = document.getElementById("myHeader");
    var sticky = header.offsetTop;
    
    function myFunction() {
      if (window.pageYOffset > sticky) {
        header.classList.add("sticky_esg");
      } else {
        header.classList.remove("sticky_esg");
      }
    }
        </script>
    <%- include('../templates/footer.ejs') %>